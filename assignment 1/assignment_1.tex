\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{titling}

% Header
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{} % empties all fields
\fancyhead[L]{IDATT2503 - Exercise 1}
\fancyhead[R]{Francesca Grimaldi}

% Lists
\usepackage{listings}
\usepackage{enumitem}
\setlist{topsep=2pt, itemsep=2pt, partopsep=2pt, parsep=2pt}

\newcommand{\subtitle}[1]{%
  \posttitle{%
    \par\end{center}
    \begin{center}\large#1\end{center}
    \vskip0.5em}
}

% Title and info
\setlength{\droptitle}{-10em}

\title{%
    % \vspace{4cm}
    \huge Assignment 1
}

\subtitle{%
    IDATT2503 - Security in programming and cryptography\\
    Fall 2023
    % \vspace{7cm}
}

\author{%
  Francesca Grimaldi
}

\date{}

\begin{document}

% TITLE
\maketitle


% INDEX
% \tableofcontents


% QUESTION 1
\section{WebGoat}
\subsection{A1 Broken Access Control}
\subsubsection{Hijack a session}
The goal of this challenge was to predict the value of the \texttt{hijack\_cookie}.
First, I tried to access using some random credentials, and I retrieved the value of this cookie and of the session ID.
Then I tried to send other POST requests removing that cookie in order to generate other values of it.
The first half of it was a sequential number incrementing by two each time, while the second one represented a Unix date timestamp with milliseconds.
I solved the challenge bruteforcing the values with a script.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{hijack a session.png}
    \caption{Hijack a session}
    \label{fig:hijack_a_session}
\end{figure}

\subsubsection{Insecure Direct Object References}
The main focus of this lesson was on intercepting and manipulating requests and URLs to get unauthorized access to data, such as to view and modify another user's profile.
\begin{itemize}
    \item[2)] {Simply consisted in authenticating using the given credentials ('tom' and 'cat').}
    
    \item[3)] {The request was to list two attributes that were present in the server's response but not in the page.
    Looking at the values displayed after clicking on \texttt{View Profile} and comparing them to the ones in the response, the missing ones were \texttt{role} and \texttt{userId}.
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{IDOR 3.png}
        \caption{IDOR 3}
        \label{fig:idor_3}
    \end{figure}
    }
    
    \item[4)] {To view my profile, I appended the \texttt{userId} found in the previous exercise to the URL of the GET request that retrieves the profile data: \texttt{WebGoat/IDOR/profile/2342384}}
    
    \item[5)] {To view someone else's profile, I used the alternate path of the previous exercise but trying increasing the last digit.
    As I managed to find the profile of 'Buffalo Bill', I edited a PUT request in order to modify it.
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.7\textwidth]{IDOR 5b.png}
        \caption{IDOR 5a}
        \label{fig:IDOR 5a}
    \end{figure}
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.9\textwidth]{IDOR 5.png}
        \caption{IDOR 5b}
        \label{fig:IDOR 5b}
    \end{figure}
    }
\end{itemize}

\subsection{A3 Injection}
\subsubsection{SQL Injection (intro)}
This lesson's objective was to use and manipulate Structured Query Language (SQL) to perform tasks that were not the developer's original purpose, in particular through String and Numeric SQL injection.
In the following, I included the SQL queries used to complete the various requests.
\begin{itemize}
    \item[2)] {Simply required to retrieve the department of a specific employee from the employees table:\\
    \texttt{SELECT department FROM employees WHERE (first\_name='Bob'\\ AND last\_name='Franco');}}
    
    \item[3)] {Required Data Manipulation Language (DML) to change the department of an employee:\\
    \texttt{UPDATE employees SET department='Sales' WHERE (first\_name='Tobi' AND last\_name='Barnett');}}
    
    \item[4)] {Required Data Definition Language (DDL) to modify the schema and add a column to the table:\\
    \texttt{ALTER TABLE employees ADD phone varchar(20);}}
    
    \item[5)] {Required Data Control Language (DCL) to grant rights to a table to a specified user:\\
    \texttt{GRANT SELECT ON grant\_rights TO unauthorized\_user;}}
    
    \item[9)] {Required to complete a query in order to retrieve the complete list of users:\\
    \texttt{SELECT * FROM user\_data WHERE first\_name = 'John' and last\_name = 'Smith' or '1' = '1';}}
    
    \item[10)] {First, one had to find the Input Field susceptible to SQL injection (\texttt{User\_Id}), and then take advantage of that to retrieve all the data.\\
    \texttt{Login\_Count: 1\\User\_Id: 1 OR 1=1}\\
    So the complete query was:\\
    \texttt{SELECT * From user\_data WHERE Login\_Count = 1 and userid= 1 OR 1=1}}
    
    \item[11)] {Similarly to the previous one, the Input field susceptible to SQL injection was \texttt{Authentication TAN}, and to retrieve all the data:\\
    \texttt{Employee Name: Smith\\Authentication TAN: 3SL99A' OR 1=1;--}}
    
    \item[12)] {Here, the task was to change the salary of an employee modifying a table with an injection on the \texttt{Authentication TAN} field:\\
    \texttt{Employee Name: Smith\\Authentication TAN: 3SL99A'; UPDATE employees SET salary='99000' WHERE auth\_tan='3SL99A';--}}
    
    \item[13)] {Required deleting a table:\\
    \texttt{'; DROP TABLE access\_log;--}}
\end{itemize}

\subsubsection{SQL Injection (advanced)}
The goal of this lesson was to execute Blind SQL injection and combined SQL injection techniques.
\begin{itemize}
    \item[3)] {The task required to retrieve all the contents of the \texttt{user\_system\_data} table through a field susceptible to SQL injection, and then find the password of an user called Dave.\\
    \textbf{1st step:} get all the data\\
    \texttt{Name: Smith' UNION SELECT userid, user\_name, password, cookie, 'a', 'b', 1 FROM user\_system\_data;--}\\
    The values \texttt{'a', 'b', 1} needed to be added as the UNION operator requires the same number of columns on both tables.\\
    \textbf{2nd step:} check the tuples and find the one with 'Dave' as \texttt{first\_name}\\
    In this case, the tuple was \texttt{105, dave, passW0rD, , a, b, 1}, and therefore \texttt{passW0rD} was the solution.}
    
    \item[5)] {The objective was to login as 'Tom', having the possibility to play with both a login and a registration form.
    The field susceptible to SQL injection was the \texttt{Username} one in the registration form.
    In order to login, I tried to retrieve the user's password, bruteforcing inserting \texttt{tom' AND substring(password,1,1)='p} in that field.
    Depending on the response message it was clear whether the first letter of the password was correct or not ('the user already exists', or 'user successfully created').
    I proceeded letter by letter with Burp Intruder, checking the response messages for a list of characters, until I found all of them.
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{SQL injection advanced 5b.png}
        \caption{SQL 5a}
        \label{fig:SQL 5}
    \end{figure}
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{SQL injection advanced 5.png}
        \caption{SQL 5b}
        \label{fig:SQL 5}
    \end{figure}
    }
    
    \item[6)] {This exercise was actually a quiz on theoretical aspects of SQL injection. I completed it with the following answers:\\
    \texttt{
    a) A statement has got values instead of a prepared statement\\
    b) ?\\
    c) Prepared statements are compiled once by the database management system waiting for input and are pre-compiled this way.\\
    d) Placeholders can prevent that the users input gets attached to the SQL query resulting in a seperation of code and data.\\
    e) The database registers 'Robert' ); DROP TABLE Students;--'.}
    }
\end{itemize}

\subsubsection{Path traversal}
Here, path (directory) vulnerabilities are exploited to access or store files outside the application's location.
\begin{itemize}
    \item[2)] {The goal was to overwrite a specific file on the file system.
    I did so by inserting \texttt{../test} in the \texttt{Full name} field.}
    
    \item[3)] {Similar to the previous one, but with a fix that removed the sequence \texttt{../} from the input.
    It was not possible to use the same exploit, but inserting \texttt{..././test} worked.}
    
    \item[4)] {For this exercise, an additional fix was applied in order to solve the vulnerability of the \texttt{Full name} field.
    I intercepted the POST request when updating the profile and changed the file name to \texttt{../mypicture}.}
    
    \item[5)] {The request was to find a file named \texttt{path-traversal-secret.jpg}.
    I managed to do a GET request to\\\texttt{WebGoat/PathTraversal/random-picture?id=\%2e\%2e\%2f\%2e\%2e\%2fpath\\-traversal-secret}, and from the response I found out that I had to submit the SHA-512 hash of my username to solve the exercise.
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.7\textwidth]{SHA 512.png}
        \caption{Path traversal 5}
        \label{fig:SHA-512}
    \end{figure}
    }
    
    \item[7)] {This exercise required to overwrite my current profile image, circumventing a programming mistake made in the code to extract the zip file.
    I created a directory structure and a zip file with my image inside of it, with the commands:\\
    \texttt{mkdir -p /home/webgoat/.webgoat-2023.4/PathTraversal/fragrimi}\\and \texttt{zip profile.zip ../../../../../../../../home/webgoat/\\.webgoat-2023.4/PathTraversal/fragrimi/fragrimi.jpg}.\\
    Uploading this zip file solved the assignment.}
\end{itemize}

\section{Hacker101}
\subsection{Micro-CMS v1}
For this web CTF, I found the four flags in the following way:
\begin{itemize}
    \item {For the first one, I entered the \texttt{Testing} page and tried editing it.
    I attempted to manually modify the ID at the end of the URL to see if I could access some other page.
    For most of them, it gave me a 404 error, but for one ID a \texttt{Private Page} appeared, with the flag.
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.7\textwidth]{micro CMS 1.png}
        \caption{microCMS 1}
        \label{fig:microCMS 1}
    \end{figure}
    }
    
    \item {I got the second flag after trying to create a page with some script in the title (XSS).
    I added \texttt{<script>alert(a)</script>}, and as I returned to the homepage the script was executed and an alert with the flag was displayed.}
    
    \item {For the third flag, I entered the \texttt{Markdown Test} page and tried editing it.
    I added another script to be executed after clicking on the button: \texttt{<button onClick=alert(b)>Some button</button>}.
    The script was executed but it did not display the flag. Then, inspecting the page and viewing the source code, I found it in the button tag.}
    
    \item {With an SQL injection in the edit page, thus adding \texttt{';--} to the URL, the last flag appeared.}
\end{itemize}

\section{Screenshots}
This section includes the screenshots of all the challenges marked as completed.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{completed/completed hijacking.png}
    \caption{Completed Hijack a session}
    \label{fig:chas}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{completed/completed IDOR.png}
    \caption{Completed Insecure Direct Object References}
    \label{fig:cidor}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{completed/completed SQL intro.png}
    \caption{Completed SQL (intro)}
    \label{fig:csqli}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{completed/completed SQL advanced.png}
    \caption{Completed SQL (advanced)}
    \label{fig:csqla}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{completed/completed path traversal.png}
    \caption{Completed Path traversal}
    \label{fig:cpt}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{completed/completed microCMS.png}
    \caption{Completed Micro-CMS v1}
    \label{fig:cmcms1}
\end{figure}
\end{document}